              smthbbs 代码系统常见问题及解答 (smthbbs FAQ)

    本 FAQ 由 BBS 水木清华站(http://www.smth.org)系统维护组负责维护，
如有问题，欢迎来 BBS 水木清华站的 BBSMan_Dev 版参与讨论。

1. ChangeLog
2004.4.1
    flyriver 增加 FAQ 2.7 和 2.8
             修改 FAQ 2.6
2004.1.25
    flyriver 增加 FAQ 2.6
2003.7.17
    flyriver 增加 FAQ 2.5
2003.6.5
    flyriver v1.1
    调整 FAQ 文章结构，新增四个 FAQ (2.2, 2.3, 2.4, 3.3)
2002.9.16
    KCN v1.0

2. 编译和安装

2.1. make install的时候是否会覆盖原来的bbshome？
[答复]
  我们没有做文件存在检查，所以对 make install 没有做对 bbshome 的拷贝。
在一开始安装的时候手动拷贝一次 bbshome 下的文件到你的 bbs 目录下吧。

2.2. 我启动 bbsd 时出现“can't lock pid file:var/bbsd.2500.pid”，怎么回事？
[答复]
  这个问题在比较老的 smthbbs 版本里面会出现，是个 bug，但在最新的 smthbbs
  版本里面已经被修正了。
  解决办法如下：
    a) 下载并安装最新的 smthbbs，我们建议您这么做；
    b) 如果您确实想用老的 smthbbs 版本，那么可以参照以下步骤：
         cd $(BBSHOME)
         mkdir var
    c) 如果已经存在 var/ 目录，确认它的属主为 bbs 用户；
  然后再重新启动 bbsd 即可。

2.3. 我的系统已经安装了 libesmtp，configure 是却还是提示出错，说什么
  “checking for smtp_create_session in -lesmtp... no
    configure: error: The libesmtp library required”
  为什么会这样？
[答复]
  a) 检查一下您把 libesmtp 安装在 /usr 或 /usr/local 目录里面了，缺省情况下
     configure 脚本只检查这两个目录。如果您用的是操作系统自带的 libesmtp 包，
     那么安装目录一般都是在 /usr 或 /usr/local。对于 libesmtp 不是安装在 /usr
     /usr/local 的情况，可以在 configure 的时候用 --with-libesmtp=DIR 指定
     libesmtp 的安装目录；
  b) 如果您的 libesmtp 包是自己编译安装的，您一定要在 configure libesmtp 的
     加上 --disable-pthreads 参数。这个限制在未来的 smthbbs 版本里会被去除。
(注：在最新版的 smthbbs 代码中已经没有这个限制了)
  c) 如果 libesmtp 是用操作系统自带的软件包安装的，请检查一下您是否安装了相关
     的开发包 (一般会有 libesmtp-devel 或 libesmtp-dev 之类的名字)。
  d) 对于 smthbbs-1.2.1 以后的版本，不再强制您的系统里面安装了 libesmtp，所以
     不会再有这个问题。当然，如果您的系统不安装 libesmtp，则必须安装有 sendmail
     程序。

2.4. 我用的是 smthbbs-1.0.1，configure 通过，但 make 时出错，提示：
  “bbs_sendmail.c:5:22: libesmtp.h: No such file or directory”
  后面还有很多出错信息，看样子都是跟 libesmtp 有关。
[答复]
  smthbbs-1.0.1 及更早版本的 configure 脚本有 bug，检查 libesmtp 时没有给出
  足够的出错信息，这个问题在最新的 smthbbs 版本已经解决。建议您下载并安装最
  新的 smthbbs，或者参考问题 2.3 的答复。

2.5. 我执行了 ./bbsd -p 23，但 telnet 127.0.0.1 时却告诉我：
   “telnet: connect to address 127.0.0.1: Connection refused”。
[答复]
  用 bbs 用户无法启动 23 端口的服务，所以必须用 root 用户执行 ./bbsd -p 23，
  才可能使 bbsd 成功运行于 23 端口。另外还要保证执行 ./bbsd -p 23 命令之前，
  23 端口没有被占用。

2.6. 编译 smthbbs 都通过了，打开 bbsd 后，一连就断开。
[答复]
  a) 首先检查 .BOARDS 和 .PASSWDS 文件的权限是否正确，如果文件属主不是 bbs
     用户，用 chown 进行修改。另外，要注意不能直接在 $BBSHOME 目录里面执行
     chown -R bbs:bbs *，因为这样是不会修改到 .BOARDS 和 .PASSWDS 文件的。
     而必须执行 chown -R bbs:bbs $BBSHOME。$BBSHOME 是指安装 bbs 的目录。
  b) 检查 /etc/passwd 和 /etc/group 文件，看看 bbs 用户的 uid 和 gid 是否
     与代码中定义的 BBSUID 和 BBSGID 宏一致(在 site.h 文件中)。

2.7. 我从 cvs 下载的代码，用 aclocal、autoheader、automake 和 autoconf 等
    命令生成了 configure，但 make 时却出错，提示：
    “./../depcomp: ./../depcomp: No such file or directory”
[答复]
  请执行下面的命令，观察命令输出的版本信息。
      automake --version
      autoconf --version
      libtool --version

  然后对照 INSTALL 文件，看看 automake、autoconf 和 libtool 等程序的版本
  是否符合要求。如果版本符合要求，但依然出错，可以试试把系统里现有的
  automake、autoconf 和 libtool 等程序先卸载，再重新安装的办法。如果还不
  行，请向别人求助。

2.8. 编译 php 出错，说找不到 libxml2 或 freetype 之类的软件包。
[答复]
  如果 libxml2 等软件是用操作系统自带的软件包安装的，请检查一下您是否安装了
  相关的开发包 (一般会有 libxml2-devel 或 libxml2-dev 之类的名字)。自己编译
  安装的 libxml2 则不存在此问题。

2.9. 登陆WWW的时候，报告找不到bbsguestleft.html，bbsguestfoot.html之类的页面
[答复]
  smth的代码为了效率考虑，对于guest的页面采用生成静态页面的方式。bbsguestXX.html
等都是用bbsXXX.php生成的。你可以用
  wget http://www/bbsXXX.php -O tmp.html; mv -f tmp.html bbsguestXXX.html
来生成。假如编译了php的cli版本，也可以用
  php bbsXXX.php 2>/dev/null | awk 'NR>3 {print;}' > tmp.html; mv -f 
tmp.html bbsguestXXX.html

3. 管理维护

3.1. 第一次注册SYSOP的时候，说 "抱歉, 由于某些系统原因, 无法注册新的帐号."
[答复]
  这个问题有个人问过我，处理如下
    killall miscd
    killall bbslogd
  然后把共享内存区内存区清了，
  重新
    miscd daemon
    bbslogd就好了
  不知道为啥。

3.2. 刚安装完毕，建立新版的时候断线，怎么回事？
[答复]
  这个是1.0.1版以前的bug，解决办法：
    a) 下载并安装最新的 smthbbs，我们建议您这么做；
    b) 如果您确实想用老的 smthbbs 版本，那么可以参照以下步骤：
将bcache.c里面的
            ftruncate(boardfd, MAXBOARD * sizeof(struct boardheader));
这一行，移动到上面几行。
            exit(-1);
        }
        /*加到这里*/
        ftruncate(boardfd, MAXBOARD * sizeof(struct boardheader));
        /* end */
        close(boardfd);

3.3. 怎么开新讨论区？中文名有什么格式要求？
[答复]
  建立新讨论区在管理菜单里面有；
  中文名称的格式为:
      分区代号+[类名]+ 6 个空格+讨论区中文描述

  其中分区代号为 1 个字节，类名为 4 个字节。

  举例:
  0[站务]      测试用版

